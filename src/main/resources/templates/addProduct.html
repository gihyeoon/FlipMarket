<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<title>ìƒí’ˆ ë“±ë¡</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
	<div class="max-w-3xl mx-auto p-6 bg-white rounded-xl shadow">
		<h2 class="text-2xl font-bold mb-6">ğŸ“¦ ìƒí’ˆ ë“±ë¡</h2>

		<form enctype="multipart/form-data" class="space-y-4">

			<!-- ìƒí’ˆëª… -->
			<div>
				<label class="block text-sm font-medium mb-1">ìƒí’ˆëª…</label>
				<input type="text" id="product_name" name="product_name" class="w-full border rounded-md px-3 py-2"
					placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
			</div>

			<!-- ê°€ê²© -->
			<div>
				<label class="block text-sm font-medium mb-1">ê°€ê²©</label>
				<input type="number" id="price" name="price" class="w-full border rounded-md px-3 py-2"
					placeholder="ê°€ê²© (ìˆ«ìë§Œ)">
			</div>

			<!-- ìˆ˜ëŸ‰ -->
			<div>
				<label class="block text-sm font-medium mb-1">ìˆ˜ëŸ‰</label>
				<input type="number" id="quantity" name="quantity" class="w-full border rounded-md px-3 py-2" min="1"
					placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”">
			</div>

			<!-- ì¹´í…Œê³ ë¦¬ -->
			<div>
				<label class="block text-sm font-medium mb-1">ì¹´í…Œê³ ë¦¬</label>
				<select id="category" name="category" size="4" class="w-full border rounded-md px-3 py-2">
					<option value="" selected>ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
					<option value="ì‹í’ˆ">ì‹í’ˆ</option>
					<option value="ë„ì„œ">ë„ì„œ</option>
					<option value="ì˜ë¥˜">ì˜ë¥˜</option>
					<option value="ì „ìê¸°ê¸°">ì „ìê¸°ê¸°</option>
					<option value="ê¸°íƒ€">ê¸°íƒ€</option>
				</select>
			</div>

			<!-- ì„¤ëª… -->
			<div>
				<label class="block text-sm font-medium mb-1">ìƒí’ˆ ì„¤ëª…</label>
				<textarea id="description" name="description" rows="4" class="w-full border rounded-md px-3 py-2"
					placeholder="ìƒí’ˆì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
			</div>

			<!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¯¸ë¦¬ë³´ê¸° -->
			<div>
				<label class="block text-sm font-medium mb-1">ìƒí’ˆ ì´ë¯¸ì§€</label>
				<input type="file" id="image" name="image" accept="image/*" onchange="previewImage(event)"
					class="w-full border rounded-md px-3 py-2 bg-white">
				<div class="mt-3">
					<img id="imagePreview" class="w-48 h-48 object-cover rounded-md border" style="display: none;" />
				</div>
			</div>

			<!-- ë²„íŠ¼ -->
			<div class="flex justify-between mt-6">
				<a th:href="@{/main}" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">ë©”ì¸ìœ¼ë¡œ</a>
				<button type="button" onclick="addProduct(event);"
					class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ë“±ë¡</button>
			</div>
		</form>
	</div>

</body>

</html>
<th:block layout:fragment="script">
	<script th:inline="javascript">
		function previewImage(event) {
			const input = event.target;
			const preview = $("#imagePreview");

			if (input.files && input.files[0]) {
				const reader = new FileReader();
				reader.onload = function (e) {
					preview.attr("src", e.target.result).show();
				};
				reader.readAsDataURL(input.files[0]);
			} else {
				preview.attr("src", "").hide();
			}
		}

		function addProduct(event) {
			event.preventDefault();

			const formData = new FormData(); // íŒŒì¼ì„ ì—…ë¡œë“œí•  ê²ƒì´ë©´ FormDataë¥¼ ì¨ì•¼í•œë‹¤.

			const productName = $("#product_name").val();
			const category = $("#category option:selected").val();
			const quantity = $("#quantity").val();
			const price = $("#price").val();
			const desc = $("#description").val();

			if ($("#image")[0].files.length === 0) {
				alert("ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.");
				return false;
			}

			if (productName == "") {
				alert("ìƒí’ˆëª…ì„ ì ì–´ì£¼ì„¸ìš”.");
				return false;
			}

			if (category == "") {
				alert("ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
				return false;
			}

			if (quantity == "") {
				alert("ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
				return false;
			}

			if (price == "") {
				alert("ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
				return false;
			}

			if (desc == "") {
				alert("ì„¤ëª…ì„ ì ì–´ì£¼ì„¸ìš”.");
				return false;
			}

			formData.append("image", $("#image")[0].files[0]);
			formData.append("productName", productName);
			formData.append("category", category);
			formData.append("quantity", quantity);
			formData.append("price", price);
			formData.append("desc", desc);

			$.ajax({
				type: "POST",
				url: "/api/addProduct",
				data: formData,
				contentType: false,
				processData: false,

				success: function (result) {
					alert("ìƒí’ˆ ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
					window.location.href = "/main";
				},
				error: function (request, status, error) {
					alert("ìƒí’ˆ ë“±ë¡ ì˜¤ë¥˜\n code: " + request.status + "\n error: " + error);
				}
			});
		}
	</script>
</th:block>